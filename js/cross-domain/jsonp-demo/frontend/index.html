<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0,user-scalable=no"
    />

    <title>Document</title>
  </head>
  <body>
    <script>
      function getJSONP({ url, params = {}, callback = callback }) {
        // DOM
        return new Promise((resolve, reject) => {
          // 1.创建script 标签
          const script = document.createElement("script");
          // 2. 把callback 函数名 剥离
          params = { ...params, callback };
          // 3. 创建空数组
          let arr = [];
          for (let key in params) {
            // 4. 拼接字符串
            arr.push(`${key}=${params[key]}`);
          }
          console.log(arr);
          // 5. 拼接字符串
          script.src = `${url}?${arr.join("&")}`;
          // console.log(script.src);

          // 6. 定义全局函数
          window[callback] = (data) => {
            resolve(data);
          };

          // 7. 挂载到body上面
          document.body.appendChild(script);
        });
      }
      getJSONP({
        url: "http://localhost:3000/say",
        params: {
          // 查询参数
          wd: "I love you",
        },
        callback: "show", //  必须的
      }).then((data) => {
        console.log(data);
      });
    </script>
  </body>
</html>
