<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <input type="text" id="inputC" />
  <script>
    let inputC = document.getElementById('inputC');
    const ajax = function (content) { // 被节流的函数
      // fetch 
      // XMLHttpRequest
      console.log('ajax request ' + content)
    }

    function throttle(fn, delay) {
      let last, // 上一次的执行时间
        deferTimer; // timeout id 

      return function (args) {
        let that = this; // 闭包的应用场景
        let now = +new Date(); // 类型转换
        // let args = arguments;
        if (last && now < last + delay) {
          clearTimeout(deferTimer);
          deferTimer = setTimeout(function () {
            last = now;
            fn.call(that, args)
          }, delay)
        } else {
          last = now;
          fn.call(that, args);
        }
      }
    }

    let throttleAjax = throttle(ajax, 2000);
    inputC.addEventListener('keyup', function (e) {
      throttleAjax(e.target.value);
    })

    function throttle(fn, delay) {
      let curTime = Date.now();
      return function (...args) {
        let context = this;
        let nowTime = Date.now();
        if (nowTime - curTime >= delay) {
          curTime = Date.now();
          return fn.apply(context, args);
        }
      }
    }

    function throttleWithTrailing(fn, delay) {
      let lastExecTime = 0;
      let timeoutId = null;

      return function (...args) {
        const context = this;
        const now = Date.now();

        const execute = () => {
          lastExecTime = now;
          return fn.apply(context, args);
        };

        if (now - lastExecTime >= delay) {
          return execute();
        } else {
          // 延迟执行最后一次
          clearTimeout(timeoutId);
          timeoutId = setTimeout(execute, delay - (now - lastExecTime));
        }
      };
    }
  </script>
</body>

</html>